{% extends 'base_authenticated.html' %}
{% load helper_tags module_tags %}

{% block head_title %}Books{% endblock %}

{% block html_head %}
{{block.super}}
<script>
$(document).ready(function () {
  {% can user 'upload' publisher %}
  bind_upload_publication_modal();
  bind_upload_publication_form();

  $('.upload_publication_button').on('click', function(e) {
    open_upload_publication_modal();
    return false;
  });
  {% endcan %}
  
  {% if outstandings %}
  bind_publication_outstandings();
  {% endif %}
})
</script>
{% endblock %}

{% block body_authenticated %}
<div class="publisher_books_page">
  <ul class="breadcrumb">
    <li class="active">Books</li>
  </ul>

  {% can user 'upload' publisher %}
  {% if all_book_count %}
  <div class="table_actions">
    <a href="#" class="btn upload_publication_button"><span>Upload book</span></a>
  </div>
  {% endif %}
  {% endcan %}

  {% include 'publication/snippets/publication_outstandings.html' with ready=outstandings.ready scheduled=outstandings.scheduled unpublished=outstandings.unpublished %}

  {% if all_book_count %}
  <div class="books">

    <h3>Published books<span>({{books|length}} issues)</span></h3>
    {% if books %}
    <ul class="published_publications">
      {% for publication in books %}
      <li {% if forloop.last %}class="last"{% endif %}>
        <div class="cover"></div>
        <div class="statistics"></div>
        <div class="name"><a href="{% url view_publication publication.id %}">{{publication.title}}</a></div>
        <div class="status">Published on {{publication.published|format_abbr_datetime}}</div>
        <div class="stats"></div>
        {% can user 'upload' publisher %}<div class="links"><a href="{% url edit_publication publication.id %}">Edit publication</a></div>{% endcan %}

      </li>
      {% endfor %}
    </ul>
    
    {% else %}
    <div class="no_row">No published books</div>
    {% endif %}
  </div>
  {% else %}
  <div class="no_book">
    <div class="message">Your publisher has no book</div>
    {% can user 'upload' publisher %}<div><a href="#" class="btn upload_publication_button">Upload new book here</a></div>{% endcan %}
  </div>
  {% endif %}
  
</div>

{% can user 'upload' publisher %}{% generate_publication_module_upload_modal 'book' %}{% endcan %}

{% endblock %}