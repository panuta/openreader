{% extends 'base_authenticated.html' %}
{% load helper_tags document_tags %}

{% block head_title %}{% if not shelf %}สร้างชั้นหนังสือใหม่{% else %}แก้ไขชั้นหนังสือ{% endif %}{% endblock %}
{% block topnav %}{% include 'snippets/organization_topnav.html' with active_menu='document' %}{% endblock %}

{% block html_head %}
{{block.super}}
<script>
$(document).ready(function () {
  $('input[name="all_access"]').on('click', function(e) {
    var level = $('input[name="all_access"]:checked').val();
    $('.group-permissions input[value="' + level + '"]').attr("checked", "checked");
    $(this).closest('tr').addClass('active');
  });

  $('.permission_row input[type="radio"]').on('click', function(e) {
    $('input[name="all_access"]').attr("checked", false).closest('tr').removeClass('active');;
  });
})
</script>
{% endblock %}

{% block body_authenticated %}
<div class="container-fluid container-body shelf_modify_page">
  {% include 'document/snippets/documents_sidebar.html' %}

  <div class="content"><div class="content-inner">
    {% if not shelf %}
    <h2>สร้างชั้นหนังสือใหม่</h2>
    {% else %}
    <ul class="breadcrumb">
      <li><a href="{% url view_documents_by_shelf organization.slug shelf.id %}">ชั้นหนังสือ {{shelf.name}}</a> <span class="divider">/</span></li>
      <li class="active">แก้ไขชั้นหนังสือ</li>
    </ul>
    <h2>แก้ไขชั้นหนังสือ</h2>
    {% endif %}

    <form method="POST" action=".">
      {% csrf_token %}
      {{form.non_field_errors}}

      <div class="clearfix"><label for="id_name">ชื่อชั้นหนังสือ</label><div class="input">{{form.name}}{{form.name.errors}}</div></div>
      <div class="clearfix">
        <label>การเข้าถึงชั้นหนังสือ</label>
        <div class="input table-inputs group-permissions">
          <table>
            <tr>
              <td>ทุกคนใน{{organization.prefix}}</td>
              <td><label><input type="radio" name="all_access" value="publish" {% if all_access_permission == 'publish' %}checked="checked"{% endif %}/> อัพโหลดและแก้ไข</label></td>
              <td><label><input type="radio" name="all_access" value="view" {% if all_access_permission == 'view' %}checked="checked"{% endif %}/> ดูอย่างเดียว</label></td>
              <td></td>
            </tr>
            <tr>
              <th colspan="4">หรือ ตั้งค่าการเข้าถึงตามกลุ่มผู้ใช้</th>
            </tr>

            {% shelf_permissions_radio_table organization shelf_permissions %}
            
          </table>
        </div>
      </div>

      <div class="form_actions">
        <button type="submit" class="btn primary">{% if not shelf %}สร้างชั้นหนังสือ{% else %}แก้ไขชั้นหนังสือ{% endif %}</button>
        <button type="reset" class="btn">ล้างข้อมูล</button>
      </div>
    </form>

    {% if shelf %}
    <div class="delete_panel">
      <a href="{% url delete_document_shelf organization.slug shelf.id %}" class="danger">ลบชั้นหนังสือ</a>
    </div>
    {% endif %}

  </div></div>
</div>

{% endblock %}