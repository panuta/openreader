{% extends 'base_authenticated.html' %}
{% load helper_tags %}

{% block head_title %}{{document.publication.title}}{% endblock %}
{% block topnav %}{% include 'snippets/organization_topnav.html' with active_menu='document' %}{% endblock %}

{% block html_head %}
{{block.super}}
<script>
$(document).ready(function () {
  $('button.publish_button').on('click', function(e) {
    open_publish_modal('{{publication.uid}}');
    return false;
  });

  $('button.unpublish_button').on('click', function(e) {
    open_unpublish_modal('{{publication.uid}}');
    return false;
  });
});
</script>
{% endblock %}

{% block body_authenticated %}
<div class="container-fluid container-body publication_page document_page">
  <div class="sidebar">
    <div class="cover"><img src="{{publication.get_large_thumbnail}}" /></div>
  </div>

  <div class="content"><div class="content-inner">
    <ul class="breadcrumb">
      <li><a href="{% url view_documents organization.slug %}">ไฟล์ทั้งหมด</a> <span class="divider">/</span></li>
      <li class="active">{{publication.title}}</li>
    </ul>

    <h2>
      {{publication.title}}
      <div class="uploaded">อัพโหลดเมื่อวันที่ {{publication.uploaded|format_abbr_datetime}} โดย {{publication.uploaded_by.get_profile.get_fullname}}</div>
    </h2>
  
    <div class="page_actions">
      {% can user 'edit' organization %}{% if publication.status == PUBLICATION_STATUS_UNPUBLISHED %}{% if publication.is_publish_when_ready %}<button class="primary btn unpublish_button"><span>หยุดการเผยแพร่</span></button>{% else %}<button class="primary btn publish_button"><span>เผยแพร่</span></button>{% endif %}{% endif %}{% endcan %}
      {% can user 'edit' organization %}{% if publication.status == PUBLICATION_STATUS_PUBLISHED %}<button class="btn unpublish_button"><span>หยุดการเผยแพร่</span></button>{% endif %}{% endcan %}
      <a href="{% url download_publication publication.uid %}" class="btn download_publication_button"><span>ดาวน์โหลดไฟล์</span></a>
      {% can user 'edit' organization %}<a href="{% url edit_document publication.uid %}" class="btn edit_publication_button"><span>แก้ไขรายละเอียด</span></a>{% endcan %}
    </div>
    
    {% if shelves %}
    <h3>ชั้นหนังสือ</h3>
    <ul class="shelves">
      {% for shelf in shelves %}
        <li><a href="{% url view_documents_by_shelf organization.slug shelf.shelf.id %}">{{shelf.shelf.name}}</a></li>
      {% endfor %}
    </ul>
    {% endif %}

    <div class="details">
      <h3>เนื้อหาไฟล์</h3>
      {% if publication.description %}
      <p>{{publication.description}}</p>
      {% else %}
      <div class="no">ไม่มีข้อมูลเนื้อหาไฟล์</div>
      {% endif %}
    </div>

    <!-- 
    <div class="statistics">
      <h3>สถิติ</h3>
      statistics
    </div>
    -->

  </div></div>
</div>
{% endblock %}